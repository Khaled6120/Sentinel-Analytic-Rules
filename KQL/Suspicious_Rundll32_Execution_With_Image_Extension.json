{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/4aa6040b-3f28-44e3-a769-9208e5feb5ec')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/4aa6040b-3f28-44e3-a769-9208e5feb5ec')]",
      "properties": {
        "alertRuleTemplateName": "4aa6040b-3f28-44e3-a769-9208e5feb5ec",
        "author": "Hieu Tran",
        "customDetails": null,
        "date": "2023/03/13",
        "description": "Detects the execution of Rundll32.exe with DLL files masquerading as image files",
        "displayName": "Suspicious Rundll32 Execution With Image Extension",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "",
        "query": "DeviceProcessEvents\n| where (ProcessCommandLine contains \".bmp\" or ProcessCommandLine contains \".cr2\" or ProcessCommandLine contains \".eps\" or ProcessCommandLine contains \".gif\" or ProcessCommandLine contains \".ico\" or ProcessCommandLine contains \".jpeg\" or ProcessCommandLine contains \".jpg\" or ProcessCommandLine contains \".nef\" or ProcessCommandLine contains \".orf\" or ProcessCommandLine contains \".png\" or ProcessCommandLine contains \".raw\" or ProcessCommandLine contains \".sr2\" or ProcessCommandLine contains \".tif\" or ProcessCommandLine contains \".tiff\") and (FolderPath endswith \"\\\\rundll32.exe\" or ProcessVersionInfoOriginalFileName =~ \"RUNDLL32.exe\")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": null,
        "techniques": [
          "t1218"
        ],
        "templateVersion": "1.0.0",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
