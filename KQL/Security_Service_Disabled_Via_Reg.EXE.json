{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/5e95028c-5229-4214-afae-d653d573d0ec')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/5e95028c-5229-4214-afae-d653d573d0ec')]",
      "properties": {
        "alertRuleTemplateName": "5e95028c-5229-4214-afae-d653d573d0ec",
        "author": "Florian Roth (Nextron Systems), John Lambert (idea), elhoim",
        "customDetails": null,
        "date": "2021/07/14",
        "description": "Detects execution of \"reg.exe\" to disable security services such as Windows Defender.",
        "displayName": "Security Service Disabled Via Reg.EXE",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/06/05",
        "query": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"\\\\AppIDSvc\" or ProcessCommandLine contains \"\\\\MsMpSvc\" or ProcessCommandLine contains \"\\\\NisSrv\" or ProcessCommandLine contains \"\\\\SecurityHealthService\" or ProcessCommandLine contains \"\\\\Sense\" or ProcessCommandLine contains \"\\\\UsoSvc\" or ProcessCommandLine contains \"\\\\WdBoot\" or ProcessCommandLine contains \"\\\\WdFilter\" or ProcessCommandLine contains \"\\\\WdNisDrv\" or ProcessCommandLine contains \"\\\\WdNisSvc\" or ProcessCommandLine contains \"\\\\WinDefend\" or ProcessCommandLine contains \"\\\\wscsvc\" or ProcessCommandLine contains \"\\\\wuauserv\") and (ProcessCommandLine contains \"d 4\" and ProcessCommandLine contains \"v Start\")) and (ProcessCommandLine contains \"reg\" and ProcessCommandLine contains \"add\")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": null,
        "techniques": [
          "t1562"
        ],
        "templateVersion": "1.0.0",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
