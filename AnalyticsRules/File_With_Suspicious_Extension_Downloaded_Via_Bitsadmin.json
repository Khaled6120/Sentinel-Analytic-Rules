{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/5b80a791-ad9b-4b75-bcc1-ad4e1e89c200')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/5b80a791-ad9b-4b75-bcc1-ad4e1e89c200')]",
      "properties": {
        "alertRuleTemplateName": "5b80a791-ad9b-4b75-bcc1-ad4e1e89c200",
        "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
        "customDetails": null,
        "date": "2022/06/28",
        "description": "Detects usage of bitsadmin downloading a file with a suspicious extension",
        "displayName": "File With Suspicious Extension Downloaded Via Bitsadmin",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/05/30",
        "query": "DeviceProcessEvents\n| where (ProcessCommandLine contains \".7z\" or ProcessCommandLine contains \".asax\" or ProcessCommandLine contains \".ashx\" or ProcessCommandLine contains \".asmx\" or ProcessCommandLine contains \".asp\" or ProcessCommandLine contains \".aspx\" or ProcessCommandLine contains \".bat\" or ProcessCommandLine contains \".cfm\" or ProcessCommandLine contains \".cgi\" or ProcessCommandLine contains \".chm\" or ProcessCommandLine contains \".cmd\" or ProcessCommandLine contains \".dll\" or ProcessCommandLine contains \".gif\" or ProcessCommandLine contains \".jpeg\" or ProcessCommandLine contains \".jpg\" or ProcessCommandLine contains \".jsp\" or ProcessCommandLine contains \".jspx\" or ProcessCommandLine contains \".log\" or ProcessCommandLine contains \".png\" or ProcessCommandLine contains \".ps1\" or ProcessCommandLine contains \".psm1\" or ProcessCommandLine contains \".rar\" or ProcessCommandLine contains \".scf\" or ProcessCommandLine contains \".sct\" or ProcessCommandLine contains \".txt\" or ProcessCommandLine contains \".vbe\" or ProcessCommandLine contains \".vbs\" or ProcessCommandLine contains \".war\" or ProcessCommandLine contains \".wsf\" or ProcessCommandLine contains \".wsh\" or ProcessCommandLine contains \".xll\" or ProcessCommandLine contains \".zip\") and (ProcessCommandLine contains \" /transfer \" or ProcessCommandLine contains \" /create \" or ProcessCommandLine contains \" /addfile \") and (FolderPath endswith \"\\\\bitsadmin.exe\" or ProcessVersionInfoOriginalFileName =~ \"bitsadmin.exe\")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "persistence"
        ],
        "techniques": [
          "T1036",
          "T1197"
        ],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
