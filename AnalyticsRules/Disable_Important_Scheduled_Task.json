{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/9ac94dc8-9042-493c-ba45-3b5e7c86b980')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/9ac94dc8-9042-493c-ba45-3b5e7c86b980')]",
      "properties": {
        "alertRuleTemplateName": "9ac94dc8-9042-493c-ba45-3b5e7c86b980",
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "customDetails": null,
        "date": "2021/12/26",
        "description": "Detects when adversaries stop services or processes by disabling their respective scheduled tasks in order to conduct data destructive activities",
        "displayName": "Disable Important Scheduled Task",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2022/09/02",
        "query": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"\\\\Windows\\\\BitLocker\" or ProcessCommandLine contains \"\\\\Windows\\\\ExploitGuard\" or ProcessCommandLine contains \"\\\\Windows\\\\SystemRestore\\\\SR\" or ProcessCommandLine contains \"\\\\Windows\\\\UpdateOrchestrator\\\\\" or ProcessCommandLine contains \"\\\\Windows\\\\Windows Defender\\\\\" or ProcessCommandLine contains \"\\\\Windows\\\\WindowsBackup\\\\\" or ProcessCommandLine contains \"\\\\Windows\\\\WindowsUpdate\\\\\") and (ProcessCommandLine contains \"/Change\" and ProcessCommandLine contains \"/TN\" and ProcessCommandLine contains \"/disable\") and FolderPath endswith \"\\\\schtasks.exe\"",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "impact"
        ],
        "techniques": [
          "T1489"
        ],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
