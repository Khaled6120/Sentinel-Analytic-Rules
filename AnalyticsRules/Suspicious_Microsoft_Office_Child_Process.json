{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/438025f9-5856-4663-83f7-52f878a70a50')]",
      "kind": "NRT",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/438025f9-5856-4663-83f7-52f878a70a50')]",
      "properties": {
        "alertRuleTemplateName": "438025f9-5856-4663-83f7-52f878a70a50",
        "author": "Florian Roth (Nextron Systems), Markus Neis, FPT.EagleEye Team, Vadim Khrykov, Cyb3rEng, Michael Haag, Christopher Peacock @securepeacock, @scythe_io",
        "customDetails": null,
        "date": "2018/04/06",
        "description": "Detects a suspicious process spawning from one of the Microsoft Office suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.)",
        "displayName": "Suspicious Microsoft Office Child Process",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/04/24",
        "query": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath endswith \"\\\\EQNEDT32.EXE\" or InitiatingProcessFolderPath endswith \"\\\\EXCEL.EXE\" or InitiatingProcessFolderPath endswith \"\\\\MSACCESS.EXE\" or InitiatingProcessFolderPath endswith \"\\\\MSPUB.exe\" or InitiatingProcessFolderPath endswith \"\\\\ONENOTE.EXE\" or InitiatingProcessFolderPath endswith \"\\\\POWERPNT.exe\" or InitiatingProcessFolderPath endswith \"\\\\VISIO.exe\" or InitiatingProcessFolderPath endswith \"\\\\WINWORD.EXE\" or InitiatingProcessFolderPath endswith \"\\\\wordpad.exe\" or InitiatingProcessFolderPath endswith \"\\\\wordview.exe\") and (((ProcessVersionInfoOriginalFileName in~ (\"bitsadmin.exe\", \"CertOC.exe\", \"CertUtil.exe\", \"Cmd.Exe\", \"CMSTP.EXE\", \"cscript.exe\", \"curl.exe\", \"HH.exe\", \"IEExec.exe\", \"InstallUtil.exe\", \"javaw.exe\", \"Microsoft.Workflow.Compiler.exe\", \"msdt.exe\", \"MSHTA.EXE\", \"msiexec.exe\", \"Msxsl.exe\", \"odbcconf.exe\", \"pcalua.exe\", \"PowerShell.EXE\", \"RegAsm.exe\", \"RegSvcs.exe\", \"REGSVR32.exe\", \"RUNDLL32.exe\", \"schtasks.exe\", \"ScriptRunner.exe\", \"wmic.exe\", \"WorkFolders.exe\", \"wscript.exe\")) or (FolderPath endswith \"\\\\AppVLP.exe\" or FolderPath endswith \"\\\\bash.exe\" or FolderPath endswith \"\\\\bitsadmin.exe\" or FolderPath endswith \"\\\\certoc.exe\" or FolderPath endswith \"\\\\certutil.exe\" or FolderPath endswith \"\\\\cmd.exe\" or FolderPath endswith \"\\\\cmstp.exe\" or FolderPath endswith \"\\\\control.exe\" or FolderPath endswith \"\\\\cscript.exe\" or FolderPath endswith \"\\\\curl.exe\" or FolderPath endswith \"\\\\forfiles.exe\" or FolderPath endswith \"\\\\hh.exe\" or FolderPath endswith \"\\\\ieexec.exe\" or FolderPath endswith \"\\\\installutil.exe\" or FolderPath endswith \"\\\\javaw.exe\" or FolderPath endswith \"\\\\mftrace.exe\" or FolderPath endswith \"\\\\Microsoft.Workflow.Compiler.exe\" or FolderPath endswith \"\\\\msbuild.exe\" or FolderPath endswith \"\\\\msdt.exe\" or FolderPath endswith \"\\\\mshta.exe\" or FolderPath endswith \"\\\\msidb.exe\" or FolderPath endswith \"\\\\msiexec.exe\" or FolderPath endswith \"\\\\msxsl.exe\" or FolderPath endswith \"\\\\odbcconf.exe\" or FolderPath endswith \"\\\\pcalua.exe\" or FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\" or FolderPath endswith \"\\\\regasm.exe\" or FolderPath endswith \"\\\\regsvcs.exe\" or FolderPath endswith \"\\\\regsvr32.exe\" or FolderPath endswith \"\\\\rundll32.exe\" or FolderPath endswith \"\\\\schtasks.exe\" or FolderPath endswith \"\\\\scrcons.exe\" or FolderPath endswith \"\\\\scriptrunner.exe\" or FolderPath endswith \"\\\\sh.exe\" or FolderPath endswith \"\\\\svchost.exe\" or FolderPath endswith \"\\\\verclsid.exe\" or FolderPath endswith \"\\\\wmic.exe\" or FolderPath endswith \"\\\\workfolders.exe\" or FolderPath endswith \"\\\\wscript.exe\")) or (FolderPath contains \"\\\\AppData\\\\\" or FolderPath contains \"\\\\Users\\\\Public\\\\\" or FolderPath contains \"\\\\ProgramData\\\\\" or FolderPath contains \"\\\\Windows\\\\Tasks\\\\\" or FolderPath contains \"\\\\Windows\\\\Temp\\\\\" or FolderPath contains \"\\\\Windows\\\\System32\\\\Tasks\\\\\"))",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "execution"
        ],
        "techniques": [
          "t1047",
          "t1204",
          "t1218"
        ],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
