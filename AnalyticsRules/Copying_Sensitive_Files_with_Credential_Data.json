{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/e7be6119-fc37-43f0-ad4f-1f3f99be2f9f')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/e7be6119-fc37-43f0-ad4f-1f3f99be2f9f')]",
      "properties": {
        "alertRuleTemplateName": "e7be6119-fc37-43f0-ad4f-1f3f99be2f9f",
        "author": "Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
        "customDetails": null,
        "date": "2019/10/22",
        "description": "Files with well-known filenames (sensitive files with credential data) copying",
        "displayName": "Copying Sensitive Files with Credential Data",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2022/11/11",
        "query": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"vss\" or ProcessCommandLine contains \" /m \" or ProcessCommandLine contains \" /y \") and (FolderPath endswith \"\\\\esentutl.exe\" or ProcessVersionInfoOriginalFileName =~ \"\\\\esentutl.exe\")) or (ProcessCommandLine contains \"\\\\windows\\\\ntds\\\\ntds.dit\" or ProcessCommandLine contains \"\\\\config\\\\sam\" or ProcessCommandLine contains \"\\\\config\\\\security\" or ProcessCommandLine contains \"\\\\config\\\\system \" or ProcessCommandLine contains \"\\\\repair\\\\sam\" or ProcessCommandLine contains \"\\\\repair\\\\system\" or ProcessCommandLine contains \"\\\\repair\\\\security\" or ProcessCommandLine contains \"\\\\config\\\\RegBack\\\\sam\" or ProcessCommandLine contains \"\\\\config\\\\RegBack\\\\system\" or ProcessCommandLine contains \"\\\\config\\\\RegBack\\\\security\")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": null,
        "techniques": [
          "t1003"
        ],
        "templateVersion": "1.0.0",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
