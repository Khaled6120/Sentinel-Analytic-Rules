{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/4b991083-3d0e-44ce-8fc4-b254025d8d4b')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/4b991083-3d0e-44ce-8fc4-b254025d8d4b')]",
      "properties": {
        "alertRuleTemplateName": "4b991083-3d0e-44ce-8fc4-b254025d8d4b",
        "author": "Tim Rauch, Elastic (idea)",
        "customDetails": null,
        "date": "2022/09/21",
        "description": "Detects suspicious parent process for cmd.exe",
        "displayName": "Unusual Parent Process For Cmd.EXE",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/12/05",
        "query": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\cmd.exe\" and (InitiatingProcessFolderPath endswith \"\\\\csrss.exe\" or InitiatingProcessFolderPath endswith \"\\\\ctfmon.exe\" or InitiatingProcessFolderPath endswith \"\\\\dllhost.exe\" or InitiatingProcessFolderPath endswith \"\\\\epad.exe\" or InitiatingProcessFolderPath endswith \"\\\\FlashPlayerUpdateService.exe\" or InitiatingProcessFolderPath endswith \"\\\\GoogleUpdate.exe\" or InitiatingProcessFolderPath endswith \"\\\\jucheck.exe\" or InitiatingProcessFolderPath endswith \"\\\\jusched.exe\" or InitiatingProcessFolderPath endswith \"\\\\LogonUI.exe\" or InitiatingProcessFolderPath endswith \"\\\\lsass.exe\" or InitiatingProcessFolderPath endswith \"\\\\regsvr32.exe\" or InitiatingProcessFolderPath endswith \"\\\\SearchIndexer.exe\" or InitiatingProcessFolderPath endswith \"\\\\SearchProtocolHost.exe\" or InitiatingProcessFolderPath endswith \"\\\\SIHClient.exe\" or InitiatingProcessFolderPath endswith \"\\\\sihost.exe\" or InitiatingProcessFolderPath endswith \"\\\\slui.exe\" or InitiatingProcessFolderPath endswith \"\\\\spoolsv.exe\" or InitiatingProcessFolderPath endswith \"\\\\sppsvc.exe\" or InitiatingProcessFolderPath endswith \"\\\\taskhostw.exe\" or InitiatingProcessFolderPath endswith \"\\\\unsecapp.exe\" or InitiatingProcessFolderPath endswith \"\\\\WerFault.exe\" or InitiatingProcessFolderPath endswith \"\\\\wermgr.exe\" or InitiatingProcessFolderPath endswith \"\\\\wlanext.exe\" or InitiatingProcessFolderPath endswith \"\\\\WUDFHost.exe\")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "medium",
        "status": "experimental",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "Execution"
        ],
        "techniques": [
          "T1059"
        ],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
