{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/efdd8dd5-cee8-4e59-9390-7d4d5e4dd6f6')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/efdd8dd5-cee8-4e59-9390-7d4d5e4dd6f6')]",
      "properties": {
        "alertRuleTemplateName": "efdd8dd5-cee8-4e59-9390-7d4d5e4dd6f6",
        "author": "Florian Roth (Nextron Systems)",
        "customDetails": null,
        "date": "2022/02/11",
        "description": "Detects suspicious patterns in program names or folders that are often found in malicious samples or hacktools",
        "displayName": "Suspicious Program Names",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/03/22",
        "query": "DeviceProcessEvents\n| where (ProcessCommandLine contains \"inject.ps1\" or ProcessCommandLine contains \"Invoke-CVE\" or ProcessCommandLine contains \"pupy.ps1\" or ProcessCommandLine contains \"payload.ps1\" or ProcessCommandLine contains \"beacon.ps1\" or ProcessCommandLine contains \"PowerView.ps1\" or ProcessCommandLine contains \"bypass.ps1\" or ProcessCommandLine contains \"obfuscated.ps1\" or ProcessCommandLine contains \"obfusc.ps1\" or ProcessCommandLine contains \"obfus.ps1\" or ProcessCommandLine contains \"obfs.ps1\" or ProcessCommandLine contains \"evil.ps1\" or ProcessCommandLine contains \"MiniDogz.ps1\" or ProcessCommandLine contains \"_enc.ps1\" or ProcessCommandLine contains \"\\\\shell.ps1\" or ProcessCommandLine contains \"\\\\rshell.ps1\" or ProcessCommandLine contains \"revshell.ps1\" or ProcessCommandLine contains \"\\\\av.ps1\" or ProcessCommandLine contains \"\\\\av_test.ps1\" or ProcessCommandLine contains \"adrecon.ps1\" or ProcessCommandLine contains \"mimikatz.ps1\" or ProcessCommandLine contains \"\\\\PowerUp_\" or ProcessCommandLine contains \"powerup.ps1\" or ProcessCommandLine contains \"\\\\Temp\\\\a.ps1\" or ProcessCommandLine contains \"\\\\Temp\\\\p.ps1\" or ProcessCommandLine contains \"\\\\Temp\\\\1.ps1\" or ProcessCommandLine contains \"Hound.ps1\" or ProcessCommandLine contains \"encode.ps1\" or ProcessCommandLine contains \"powercat.ps1\") or ((FolderPath contains \"\\\\CVE-202\" or FolderPath contains \"\\\\CVE202\") or (FolderPath endswith \"\\\\poc.exe\" or FolderPath endswith \"\\\\artifact.exe\" or FolderPath endswith \"\\\\artifact64.exe\" or FolderPath endswith \"\\\\artifact_protected.exe\" or FolderPath endswith \"\\\\artifact32.exe\" or FolderPath endswith \"\\\\artifact32big.exe\" or FolderPath endswith \"obfuscated.exe\" or FolderPath endswith \"obfusc.exe\" or FolderPath endswith \"\\\\meterpreter\"))",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "execution"
        ],
        "techniques": [
          "t1059"
        ],
        "templateVersion": "1.0.0",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
