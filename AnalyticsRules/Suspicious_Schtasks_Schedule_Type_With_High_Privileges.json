{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/7a02e22e-b885-4404-b38b-1ddc7e65258a')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/7a02e22e-b885-4404-b38b-1ddc7e65258a')]",
      "properties": {
        "alertRuleTemplateName": "7a02e22e-b885-4404-b38b-1ddc7e65258a",
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "customDetails": null,
        "date": "2022/08/31",
        "description": "Detects scheduled task creations or modification to be run with high privileges on a suspicious schedule type",
        "displayName": "Suspicious Schtasks Schedule Type With High Privileges",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "",
        "query": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\schtasks.exe\" or ProcessVersionInfoOriginalFileName =~ \"schtasks.exe\") and (ProcessCommandLine contains \"NT AUT\" or ProcessCommandLine contains \" SYSTEM\" or ProcessCommandLine contains \"HIGHEST\") and (ProcessCommandLine contains \" ONLOGON \" or ProcessCommandLine contains \" ONSTART \" or ProcessCommandLine contains \" ONCE \" or ProcessCommandLine contains \" ONIDLE \")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "medium",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "execution"
        ],
        "techniques": [
          "t1053"
        ],
        "templateVersion": "1.0.0",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
