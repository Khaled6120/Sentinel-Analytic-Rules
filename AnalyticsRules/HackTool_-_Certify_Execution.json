{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/762f2482-ff21-4970-8939-0aa317a886bb')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/762f2482-ff21-4970-8939-0aa317a886bb')]",
      "properties": {
        "alertRuleTemplateName": "762f2482-ff21-4970-8939-0aa317a886bb",
        "author": "pH-T (Nextron Systems)",
        "customDetails": null,
        "date": "2023/04/17",
        "description": "Detects Certify a tool for Active Directory certificate abuse based on PE metadata characteristics and common command line arguments.",
        "displayName": "HackTool - Certify Execution",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/04/25",
        "query": "DeviceProcessEvents\n| where (FolderPath endswith \"\\\\Certify.exe\" or ProcessVersionInfoOriginalFileName =~ \"Certify.exe\" or ProcessVersionInfoFileDescription contains \"Certify\") or ((ProcessCommandLine contains \".exe cas \" or ProcessCommandLine contains \".exe find \" or ProcessCommandLine contains \".exe pkiobjects \" or ProcessCommandLine contains \".exe request \" or ProcessCommandLine contains \".exe download \") and (ProcessCommandLine contains \" /vulnerable\" or ProcessCommandLine contains \" /template:\" or ProcessCommandLine contains \" /altname:\" or ProcessCommandLine contains \" /domain:\" or ProcessCommandLine contains \" /path:\" or ProcessCommandLine contains \" /ca:\"))",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "Discovery"
        ],
        "techniques": [
          "T1649"
        ],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
