{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/455b9d50-15a1-4b99-853f-8d37655a4c1b')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/455b9d50-15a1-4b99-853f-8d37655a4c1b')]",
      "properties": {
        "alertRuleTemplateName": "455b9d50-15a1-4b99-853f-8d37655a4c1b",
        "author": "frack113",
        "customDetails": null,
        "date": "2021/12/13",
        "description": "Detects active directory enumeration activity using known AdFind CLI flags",
        "displayName": "PUA - Suspicious ActiveDirectory Enumeration Via AdFind.EXE",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/03/05",
        "query": "DeviceProcessEvents\n| where ProcessCommandLine contains \"-sc admincountdmp\" or ProcessCommandLine contains \"-sc exchaddresses\" or (ProcessCommandLine contains \"lockoutduration\" or ProcessCommandLine contains \"lockoutthreshold\" or ProcessCommandLine contains \"lockoutobservationwindow\" or ProcessCommandLine contains \"maxpwdage\" or ProcessCommandLine contains \"minpwdage\" or ProcessCommandLine contains \"minpwdlength\" or ProcessCommandLine contains \"pwdhistorylength\" or ProcessCommandLine contains \"pwdproperties\")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "discovery"
        ],
        "techniques": [
          "T1087"
        ],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
