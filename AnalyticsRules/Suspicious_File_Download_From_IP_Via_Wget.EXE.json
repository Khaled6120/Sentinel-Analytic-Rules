{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/17f0c0a8-8bd5-4ee0-8c5f-a342c0199f35')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/17f0c0a8-8bd5-4ee0-8c5f-a342c0199f35')]",
      "properties": {
        "alertRuleTemplateName": "17f0c0a8-8bd5-4ee0-8c5f-a342c0199f35",
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "customDetails": null,
        "date": "2023/07/27",
        "description": "Detects potentially suspicious file downloads directly from IP addresses using Wget.exe",
        "displayName": "Suspicious File Download From IP Via Wget.EXE",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "",
        "query": "DeviceProcessEvents\n| where (ProcessCommandLine endswith \".ps1\" or ProcessCommandLine endswith \".ps1'\" or ProcessCommandLine endswith \".ps1\\\"\" or ProcessCommandLine endswith \".dat\" or ProcessCommandLine endswith \".dat'\" or ProcessCommandLine endswith \".dat\\\"\" or ProcessCommandLine endswith \".msi\" or ProcessCommandLine endswith \".msi'\" or ProcessCommandLine endswith \".msi\\\"\" or ProcessCommandLine endswith \".bat\" or ProcessCommandLine endswith \".bat'\" or ProcessCommandLine endswith \".bat\\\"\" or ProcessCommandLine endswith \".exe\" or ProcessCommandLine endswith \".exe'\" or ProcessCommandLine endswith \".exe\\\"\" or ProcessCommandLine endswith \".vbs\" or ProcessCommandLine endswith \".vbs'\" or ProcessCommandLine endswith \".vbs\\\"\" or ProcessCommandLine endswith \".vbe\" or ProcessCommandLine endswith \".vbe'\" or ProcessCommandLine endswith \".vbe\\\"\" or ProcessCommandLine endswith \".hta\" or ProcessCommandLine endswith \".hta'\" or ProcessCommandLine endswith \".hta\\\"\" or ProcessCommandLine endswith \".dll\" or ProcessCommandLine endswith \".dll'\" or ProcessCommandLine endswith \".dll\\\"\" or ProcessCommandLine endswith \".psm1\" or ProcessCommandLine endswith \".psm1'\" or ProcessCommandLine endswith \".psm1\\\"\") and (ProcessCommandLine matches regex \"\\\\s-O\\\\s\" or ProcessCommandLine contains \"--output-document\") and ProcessCommandLine contains \"http\" and (FolderPath endswith \"\\\\wget.exe\" or ProcessVersionInfoOriginalFileName =~ \"wget.exe\") and ProcessCommandLine matches regex \"://[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\"",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "execution"
        ],
        "techniques": [],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
