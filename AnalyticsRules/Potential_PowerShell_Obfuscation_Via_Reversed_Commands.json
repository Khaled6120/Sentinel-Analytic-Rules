{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/b6b49cd1-34d6-4ead-b1bf-176e9edba9a4')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/b6b49cd1-34d6-4ead-b1bf-176e9edba9a4')]",
      "properties": {
        "alertRuleTemplateName": "b6b49cd1-34d6-4ead-b1bf-176e9edba9a4",
        "author": "Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton",
        "customDetails": null,
        "date": "2020/10/11",
        "description": "Detects the presence of reversed PowerShell commands in the CommandLine. This is often used as a method of obfuscation by attackers",
        "displayName": "Potential PowerShell Obfuscation Via Reversed Commands",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/05/31",
        "query": "DeviceProcessEvents\n| where ((ProcessCommandLine contains \"hctac\" or ProcessCommandLine contains \"kaerb\" or ProcessCommandLine contains \"dnammoc\" or ProcessCommandLine contains \"ekovn\" or ProcessCommandLine contains \"eliFd\" or ProcessCommandLine contains \"rahc\" or ProcessCommandLine contains \"etirw\" or ProcessCommandLine contains \"golon\" or ProcessCommandLine contains \"tninon\" or ProcessCommandLine contains \"eddih\" or ProcessCommandLine contains \"tpircS\" or ProcessCommandLine contains \"ssecorp\" or ProcessCommandLine contains \"llehsrewop\" or ProcessCommandLine contains \"esnopser\" or ProcessCommandLine contains \"daolnwod\" or ProcessCommandLine contains \"tneilCbeW\" or ProcessCommandLine contains \"tneilc\" or ProcessCommandLine contains \"ptth\" or ProcessCommandLine contains \"elifotevas\" or ProcessCommandLine contains \"46esab\" or ProcessCommandLine contains \"htaPpmeTteG\" or ProcessCommandLine contains \"tcejbO\" or ProcessCommandLine contains \"maerts\" or ProcessCommandLine contains \"hcaerof\" or ProcessCommandLine contains \"retupmoc\") and ((FolderPath endswith \"\\\\powershell.exe\" or FolderPath endswith \"\\\\pwsh.exe\") or (ProcessVersionInfoOriginalFileName in~ (\"PowerShell.EXE\", \"pwsh.dll\")))) and (not((ProcessCommandLine contains \" -EncodedCommand \" or ProcessCommandLine contains \" -enc \")))",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "execution"
        ],
        "techniques": [
          "t1027",
          "t1059"
        ],
        "templateVersion": "1.0.0",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
