{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/333cdbe8-27bb-4246-bf82-b41a0dca4b70')]",
      "kind": "NRT",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/333cdbe8-27bb-4246-bf82-b41a0dca4b70')]",
      "properties": {
        "alertRuleTemplateName": "333cdbe8-27bb-4246-bf82-b41a0dca4b70",
        "author": "Markus Neis, @markus_neis",
        "customDetails": null,
        "date": "2021/07/07",
        "description": "Detects the image load of vss_ps.dll by uncommon executables",
        "displayName": "Suspicious Volume Shadow Copy VSS_PS.dll Load",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "image_load",
          "product": "windows"
        },
        "modified": "2024/03/28",
        "query": "DeviceImageLoadEvents\n| where FolderPath endswith \"\\\\vss_ps.dll\" and (not((isnull(InitiatingProcessFolderPath) or ((InitiatingProcessFolderPath endswith \"\\\\clussvc.exe\" or InitiatingProcessFolderPath endswith \"\\\\dismhost.exe\" or InitiatingProcessFolderPath endswith \"\\\\dllhost.exe\" or InitiatingProcessFolderPath endswith \"\\\\inetsrv\\\\appcmd.exe\" or InitiatingProcessFolderPath endswith \"\\\\inetsrv\\\\iissetup.exe\" or InitiatingProcessFolderPath endswith \"\\\\msiexec.exe\" or InitiatingProcessFolderPath endswith \"\\\\rundll32.exe\" or InitiatingProcessFolderPath endswith \"\\\\searchindexer.exe\" or InitiatingProcessFolderPath endswith \"\\\\srtasks.exe\" or InitiatingProcessFolderPath endswith \"\\\\svchost.exe\" or InitiatingProcessFolderPath endswith \"\\\\System32\\\\SystemPropertiesAdvanced.exe\" or InitiatingProcessFolderPath endswith \"\\\\taskhostw.exe\" or InitiatingProcessFolderPath endswith \"\\\\thor.exe\" or InitiatingProcessFolderPath endswith \"\\\\thor64.exe\" or InitiatingProcessFolderPath endswith \"\\\\tiworker.exe\" or InitiatingProcessFolderPath endswith \"\\\\vssvc.exe\" or InitiatingProcessFolderPath endswith \"\\\\WmiPrvSE.exe\" or InitiatingProcessFolderPath endswith \"\\\\wsmprovhost.exe\") and InitiatingProcessFolderPath startswith \"C:\\\\Windows\\\\\") or (InitiatingProcessFolderPath startswith \"C:\\\\Program Files\\\\\" or InitiatingProcessFolderPath startswith \"C:\\\\Program Files (x86)\\\\\") or (InitiatingProcessCommandLine contains \"\\\\dismhost.exe {\" and InitiatingProcessCommandLine startswith \"C:\\\\$WinREAgent\\\\Scratch\\\\\"))))",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": [
          "impact"
        ],
        "techniques": [
          "t1490"
        ],
        "templateVersion": "1.0.0",
        "triggerOperator": "GreaterThan",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
