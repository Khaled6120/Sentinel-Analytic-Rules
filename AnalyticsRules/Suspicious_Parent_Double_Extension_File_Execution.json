{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2023-02-01-preview",
      "id": "[concat(resourceId('Microsoft.OperationalInsights/workspaces/providers', parameters('workspace'), 'Microsoft.SecurityInsights'),'/alertRules/5e6a80c8-2d45-4633-9ef4-fa2671a39c5c')]",
      "kind": "Scheduled",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/5e6a80c8-2d45-4633-9ef4-fa2671a39c5c')]",
      "properties": {
        "alertRuleTemplateName": "5e6a80c8-2d45-4633-9ef4-fa2671a39c5c",
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "customDetails": null,
        "date": "2023/01/06",
        "description": "Detect execution of suspicious double extension files in ParentCommandLine",
        "displayName": "Suspicious Parent Double Extension File Execution",
        "enabled": true,
        "entityMappings": null,
        "eventGroupingSettings": {
          "aggregationKind": "SingleAlert"
        },
        "logsource": {
          "category": "process_creation",
          "product": "windows"
        },
        "modified": "2023/02/28",
        "query": "DeviceProcessEvents\n| where (InitiatingProcessFolderPath endswith \".doc.lnk\" or InitiatingProcessFolderPath endswith \".docx.lnk\" or InitiatingProcessFolderPath endswith \".xls.lnk\" or InitiatingProcessFolderPath endswith \".xlsx.lnk\" or InitiatingProcessFolderPath endswith \".ppt.lnk\" or InitiatingProcessFolderPath endswith \".pptx.lnk\" or InitiatingProcessFolderPath endswith \".rtf.lnk\" or InitiatingProcessFolderPath endswith \".pdf.lnk\" or InitiatingProcessFolderPath endswith \".txt.lnk\" or InitiatingProcessFolderPath endswith \".doc.js\" or InitiatingProcessFolderPath endswith \".docx.js\" or InitiatingProcessFolderPath endswith \".xls.js\" or InitiatingProcessFolderPath endswith \".xlsx.js\" or InitiatingProcessFolderPath endswith \".ppt.js\" or InitiatingProcessFolderPath endswith \".pptx.js\" or InitiatingProcessFolderPath endswith \".rtf.js\" or InitiatingProcessFolderPath endswith \".pdf.js\" or InitiatingProcessFolderPath endswith \".txt.js\") or (InitiatingProcessCommandLine contains \".doc.lnk\" or InitiatingProcessCommandLine contains \".docx.lnk\" or InitiatingProcessCommandLine contains \".xls.lnk\" or InitiatingProcessCommandLine contains \".xlsx.lnk\" or InitiatingProcessCommandLine contains \".ppt.lnk\" or InitiatingProcessCommandLine contains \".pptx.lnk\" or InitiatingProcessCommandLine contains \".rtf.lnk\" or InitiatingProcessCommandLine contains \".pdf.lnk\" or InitiatingProcessCommandLine contains \".txt.lnk\" or InitiatingProcessCommandLine contains \".doc.js\" or InitiatingProcessCommandLine contains \".docx.js\" or InitiatingProcessCommandLine contains \".xls.js\" or InitiatingProcessCommandLine contains \".xlsx.js\" or InitiatingProcessCommandLine contains \".ppt.js\" or InitiatingProcessCommandLine contains \".pptx.js\" or InitiatingProcessCommandLine contains \".rtf.js\" or InitiatingProcessCommandLine contains \".pdf.js\" or InitiatingProcessCommandLine contains \".txt.js\")",
        "queryFrequency": "P1D",
        "queryPeriod": "P1D",
        "sentinelEntitiesMappings": null,
        "severity": "high",
        "status": "test",
        "suppressionDuration": "PT5H",
        "suppressionEnabled": false,
        "tactics": null,
        "techniques": [
          "t1036"
        ],
        "templateVersion": "1.0.0",
        "triggerThreshold": 0
      },
      "type": "Microsoft.OperationalInsights/workspaces/providers/alertRules"
    }
  ]
}
